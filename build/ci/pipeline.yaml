
def project_name = "calculatorGo"

pipeline {
 agent {
  label 'master'
 }

 stages {

   stage('Checkout code from SCM') {
    steps {
     println "[INFO]...........................................................................................\
            \n[INFO].. Pipeline for automating build of calculator miscroservice..\
            \n[INFO]..........................................................................................."
     git([url: 'https://github.com/ds4tech/pipeline-calculator-ws.git', branch: 'master'])
     }
    }

    stage('Build') {
      steps {
        println "[INFO]..........Build.............."
        script {
          dir("cmd/calculator") {
               sh "set -x; go build -o ${project_name};"
          }
        }
      }
     }

    stage('Run Unit tests') {
      steps {
        println "[INFO]..........Unit tests.............."
        script {
          dir("cmd/calculator") {
               sh 'set -x; cd calculator_ws; go test'
          }
        }
      }
     }

    stage('Push to articaftory') {
     steps {

      println "[INFO]..........Push to articaftory.............."

      script {
             sh "set -x; tar -cvf ${project_name}-${env.BUILD_NUMBER}.tar.gz *; ls"
             }
      }
     }

 } //end stages

 post {
   cleanup {
       cleanWs()
   }
 }

} //end pipeline
